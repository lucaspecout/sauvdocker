{% extends "base.html" %}

{% block content %}
<section class="hero">
  <div>
    <h2>Tableau de bord des sauvegardes</h2>
    <p>Automatisation, alertes et restauration directe des conteneurs et images.</p>
  </div>
  <div class="hero-badge">
    <span>üîí S√©curit√© maximale activ√©e</span>
  </div>
</section>

{% if force_password_change %}
  <div class="alert warning">Votre mot de passe doit √™tre modifi√© avant d'utiliser toutes les fonctionnalit√©s.</div>
{% endif %}

<section class="grid">
  <div class="panel">
    <h3>Conteneurs d√©tect√©s</h3>
    <div class="card-list">
      {% for container in containers %}
        <div class="card">
          <div>
            <h4>{{ container.name }}</h4>
            <p>ID: {{ container.short_id }}</p>
            <p>Status: {{ container.status }}</p>
          </div>
          <form method="post" action="{{ url_for('backup_container_route', container_id=container.id) }}">
            <button type="submit">Sauvegarder</button>
          </form>
        </div>
      {% else %}
        <p>Aucun conteneur d√©tect√©.</p>
      {% endfor %}
    </div>
  </div>

  <div class="panel">
    <h3>Images d√©tect√©es</h3>
    <div class="card-list">
      {% for image in images %}
        <div class="card">
          <div>
            <h4>{{ image.tags[0] if image.tags else image.short_id }}</h4>
            <p>ID: {{ image.short_id }}</p>
          </div>
          <form method="post" action="{{ url_for('backup_image_route', image_id=image.id) }}">
            <button type="submit">Sauvegarder</button>
          </form>
        </div>
      {% else %}
        <p>Aucune image d√©tect√©e.</p>
      {% endfor %}
    </div>
  </div>

  <div class="panel">
    <h3>Volumes d√©tect√©s</h3>
    <div class="card-list">
      {% for volume in volumes %}
        <div class="card">
          <div>
            <h4>{{ volume.name }}</h4>
            <p>Driver: {{ volume.attrs.get("Driver", "local") }}</p>
          </div>
        </div>
      {% else %}
        <p>Aucun volume d√©tect√©.</p>
      {% endfor %}
    </div>
  </div>
</section>

<section class="panel">
  <h3>Historique des sauvegardes</h3>
  <div class="table">
    <div class="table-row header">
      <span>Type</span>
      <span>Nom</span>
      <span>Date</span>
      <span>Statut</span>
      <span>Actions</span>
    </div>
    {% for backup in backups %}
      <div class="table-row">
        <span>{{ backup[1] }}</span>
        <span>{{ backup[2] }}</span>
        <span>{{ backup[4] }}</span>
        <span class="status {{ backup[5] }}">{{ backup[5] }}</span>
        <span class="actions">
          <a href="{{ url_for('download_backup', filename=backup[3].split('/')[-1]) }}">T√©l√©charger</a>
          <form method="post" action="{{ url_for('restore_backup') }}">
            <input type="hidden" name="backup_id" value="{{ backup[0] }}">
            <button type="submit">Restaurer</button>
          </form>
          <form method="post" action="{{ url_for('manual_drive_transfer') }}">
            <input type="hidden" name="backup_id" value="{{ backup[0] }}">
            <button type="submit" class="ghost">Vers Drive</button>
          </form>
        </span>
      </div>
    {% else %}
      <p>Aucune sauvegarde encore.</p>
    {% endfor %}
  </div>
</section>
{% endblock %}
